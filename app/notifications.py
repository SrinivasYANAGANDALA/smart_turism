from datetime import datetime

def send_sos_email(send_email, user, latitude, longitude):
    if not user.emergency_contact_email:
        print("âŒ No emergency contact email found")
        return

    subject = "ğŸš¨ URGENT SOS ALERT â€“ Immediate Assistance Required"

    body = f"""
ğŸš¨ EMERGENCY SOS ALERT ğŸš¨

This is an automated emergency alert generated by the TravelBuddy Safety System.

âš ï¸ A registered traveler has pressed the SOS button and may be in danger.

--------------------------------------------------
TRAVELER DETAILS
--------------------------------------------------
Name              : {user.name}
Registered Email  : {user.email}
Contact Number    : {user.phone_number}

--------------------------------------------------
LAST KNOWN LOCATION
--------------------------------------------------
Latitude  : {latitude}
Longitude : {longitude}

Google Maps Link:
https://www.google.com/maps?q={latitude},{longitude}

--------------------------------------------------
TIME OF ALERT
--------------------------------------------------
{datetime.utcnow().strftime('%Y-%m-%d %H:%M UTC')}

--------------------------------------------------
IMPORTANT ACTION REQUIRED
--------------------------------------------------
â€¢ Please contact the traveler immediately.
â€¢ If unreachable, inform local emergency services.
â€¢ Share this location with responders.

âš ï¸ DO NOT IGNORE THIS MESSAGE.

â€” TravelBuddy Safety Team
"""

    send_email(subject, [user.emergency_contact_email], body)
    print("âœ… SOS EMAIL SENT")


def send_trip_created_email(send_email, user, trip):
    subject = "âœ… Trip Confirmed â€“ Your TravelBuddy Journey Begins!"

    body = f"""
Hello {user.name},

Your trip has been successfully registered in the TravelBuddy system.

--------------------------------------------------
TRIP DETAILS
--------------------------------------------------
Trip Title   : {trip.title}
Destination  : {trip.destination}
Start Date   : {trip.start_date}
End Date     : {trip.end_date}
Budget       : â‚¹{trip.budget}

--------------------------------------------------
SAFETY STATUS
--------------------------------------------------
âœ” SOS Emergency Button Enabled
âœ” Emergency Contact Linked
âœ” Real-time Tracking Available

We wish you a safe and memorable journey.

â€” TravelBuddy Team
"""

    send_email(subject, [user.email], body)
    print("âœ… Trip Created Email Sent")


def send_trip_updated_email(send_email, user, trip):
    subject = "âœï¸ Trip Updated â€“ Please Review Changes"

    body = f"""
Hello {user.name},

Your trip details have been successfully updated.

--------------------------------------------------
UPDATED TRIP DETAILS
--------------------------------------------------
Trip Title   : {trip.title}
Destination  : {trip.destination}
Start Date   : {trip.start_date}
End Date     : {trip.end_date}
Budget       : â‚¹{trip.budget}

Please review the changes in your dashboard.

â€” TravelBuddy Team
"""

    send_email(subject, [user.email], body)
    print("âœ… Trip Updated Email Sent")


def send_trip_deleted_email(send_email, user, trip):
    subject = "âŒ Trip Deleted â€“ Confirmation Notice"

    body = f"""
Hello {user.name},

This email confirms that the following trip has been deleted:

--------------------------------------------------
TRIP DETAILS
--------------------------------------------------
Trip Title  : {trip.title}
Destination : {trip.destination}

If this was not intentional, please contact support immediately.

â€” TravelBuddy Team
"""

    send_email(subject, [user.email], body)
    print("âœ… Trip Deleted Email Sent")


def send_trip_start_reminder(send_email, user, trip):
    subject = "â° Trip Reminder â€“ Your Journey Starts Tomorrow!"

    body = f"""
Hello {user.name},

This is a reminder that your upcoming trip begins soon.

--------------------------------------------------
UPCOMING TRIP
--------------------------------------------------
Destination : {trip.destination}
Start Date  : {trip.start_date}
End Date    : {trip.end_date}

--------------------------------------------------
SAFETY REMINDERS
--------------------------------------------------
âœ” Keep your phone charged
âœ” Enable GPS & Internet
âœ” SOS button is active
âœ” Emergency contact is linked

Have a safe journey!

â€” TravelBuddy Safety Team
"""

    send_email(subject, [user.email], body)
    print("âœ… Trip Reminder Email Sent")
